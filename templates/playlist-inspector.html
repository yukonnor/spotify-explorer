{% extends 'base.html' %} 
{% block title %}Playlist Inspector{% endblock %} 
{% block content %}

    <div class="container">
        <div class="row align-items-end">
            <div class="col-3">
                {% if playlist_img_url %}
                <img class="playlist-img img-responsive" width="100%" src="{{playlist_img_url}}" alt="Image (usualy album art) for the playlist">
                {% else %}
                <img class="playlist-img img-responsive" width="100%" src="{{playlist_img_url}}" alt="Image (usualy album art) for the playlist">
                {% endif %}
            </div>
            <div class="col-9">
                <h1>{{ playlist_name }}</h1>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <a href="{{playlist_link}}" target="_blank"><button type="button" class="btn btn-primary">Open Playlist in Spotify -></button></a>
            </div>
        </div>
        <div class="table-responsive">
        <table class="table table-dark table-hover">
            <thead>
                <tr>
                <th scope="col">Preview</th>
                <th scope="col">Track</th>
                <th scope="col">Artist</th>
                <th scope="col">Album</th>
                <th scope="col">Artist Genres</th>
                <th scope="col">Track Popularity</th>
                <th scope="col">Danceability</th>
                <th scope="col">Energy</th>
                <th scope="col">Artist Followers</th>
                <th scope="col">Artist Popularity</th>
                </tr>
            </thead>
            <tbody>
            {% if tracks %}
            {% for track in tracks %}
            <tr> 
                <td>
                    {% if track.preview_url %}
                    <button type="button" class="btn btn-success" onclick="playPreview('{{track.preview_url}}')">Play Preview</button>
                    <!-- Audio element for playback -->
                    <audio id="audioPlayer" controls style="display: none;">
                        Your browser does not support the audio element.
                    </audio>
                    {% endif %}
                </td>
                <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ track.name }}">{{ track.name }}</td>
                <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ track.artists[0].name }}">{{ track.artists[0].name }}</td>
                <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ track.album.name }}">{{ track.album.name }}</td>
                <td>
                    {% for genre in track.artist_genres %} 
                    <a href="/genre-inspector/{{ genre }}"><span class="genre badge rounded-pill text-bg-warning">{{ genre }}</span></a>
                    {% endfor %}
                </td>
                <td>{{ track.popularity }} </td>
                <td>{{ track.danceability }} </td>
                <td>{{ track.energy }} </td>
                <td>{{ track.artist_followers }} </td>
                <td>{{ track.artist_popularity }} </td>
            </tr>
            {% endfor %}
            {% else %}
            <p>No tracks found on that playlist :/</p>
            {% endif %}
            </tbody>
        </table>
        </div>
            
        </ul>
    </div>
    

    <!-- JavaScript to handle playback -->
    <script>
        var currentlyPlaying = false;

        function playPreview(previewUrl) {
            var audioPlayer = document.getElementById("audioPlayer");

            // Check if the audio is currently playing
            if (currentlyPlaying) {
                // If playing, pause the audio
                audioPlayer.pause();
                currentlyPlaying = false;
            } else {
                // If not playing, set the audio element source to the Spotify preview URL
                audioPlayer.src = previewUrl;

                // Play the audio
                audioPlayer.play();
                currentlyPlaying = true;

                // Attach an event listener for the 'ended' event to reset the playback state
                audioPlayer.addEventListener('ended', function() {
                    currentlyPlaying = false;
                });
            }
        }
    </script>

{% endblock %}
